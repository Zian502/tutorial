# é¢å‘å¯¹è±¡ç¼–ç¨‹

é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰æ˜¯ C++ çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ã€‚C++ æ”¯æŒç±»ã€å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰ OOP æ¦‚å¿µã€‚

## ç±»å’Œå¯¹è±¡

### åŸºæœ¬ç±»å®šä¹‰

```cpp
#include <iostream>
#include <string>

// ç±»å®šä¹‰
class Person {
private:  // ç§æœ‰æˆå‘˜ï¼ˆé»˜è®¤ï¼‰
    std::string name;
    int age;

public:  // å…¬æœ‰æˆå‘˜
    // æ„é€ å‡½æ•°
    Person(const std::string& n, int a) : name(n), age(a) {
        std::cout << "Person created: " << name << std::endl;
    }
    
    // ææ„å‡½æ•°
    ~Person() {
        std::cout << "Person destroyed: " << name << std::endl;
    }
    
    // æˆå‘˜å‡½æ•°
    void introduce() const {
        std::cout << "I'm " << name << ", " << age << " years old." << std::endl;
    }
    
    // Getter å’Œ Setter
    std::string getName() const { return name; }
    void setName(const std::string& n) { name = n; }
    
    int getAge() const { return age; }
    void setAge(int a) { age = a; }
};

int main() {
    // åˆ›å»ºå¯¹è±¡
    Person person("Alice", 25);
    person.introduce();
    
    // ä½¿ç”¨ Getter/Setter
    person.setAge(26);
    std::cout << "New age: " << person.getAge() << std::endl;
    
    return 0;
    // å¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°
}
```

### è®¿é—®æ§åˆ¶

```cpp
#include <iostream>

class Example {
public:      // å…¬æœ‰ï¼šå¤–éƒ¨å¯ä»¥è®¿é—®
    int public_var;
    void public_func() {
        std::cout << "Public function" << std::endl;
    }

private:     // ç§æœ‰ï¼šåªæœ‰ç±»å†…éƒ¨å¯ä»¥è®¿é—®
    int private_var;
    void private_func() {
        std::cout << "Private function" << std::endl;
    }

protected:   // å—ä¿æŠ¤ï¼šç±»å†…éƒ¨å’Œæ´¾ç”Ÿç±»å¯ä»¥è®¿é—®
    int protected_var;
    void protected_func() {
        std::cout << "Protected function" << std::endl;
    }
};

int main() {
    Example obj;
    obj.public_var = 10;      // OK
    obj.public_func();        // OK
    
    // obj.private_var = 20;  // é”™è¯¯ï¼ä¸èƒ½è®¿é—®ç§æœ‰æˆå‘˜
    // obj.private_func();     // é”™è¯¯ï¼
    // obj.protected_var = 30; // é”™è¯¯ï¼ä¸èƒ½è®¿é—®å—ä¿æŠ¤æˆå‘˜
    
    return 0;
}
```

### æ„é€ å‡½æ•°

```cpp
#include <iostream>
#include <string>

class Rectangle {
private:
    double width;
    double height;

public:
    // é»˜è®¤æ„é€ å‡½æ•°
    Rectangle() : width(0), height(0) {
        std::cout << "Default constructor" << std::endl;
    }
    
    // å‚æ•°åŒ–æ„é€ å‡½æ•°
    Rectangle(double w, double h) : width(w), height(h) {
        std::cout << "Parameterized constructor" << std::endl;
    }
    
    // å¤åˆ¶æ„é€ å‡½æ•°
    Rectangle(const Rectangle& other) 
        : width(other.width), height(other.height) {
        std::cout << "Copy constructor" << std::endl;
    }
    
    // ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰
    Rectangle(Rectangle&& other) noexcept
        : width(other.width), height(other.height) {
        other.width = 0;
        other.height = 0;
        std::cout << "Move constructor" << std::endl;
    }
    
    // å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰
    Rectangle(double side) : Rectangle(side, side) {
        std::cout << "Delegating constructor" << std::endl;
    }
    
    double area() const {
        return width * height;
    }
};

int main() {
    Rectangle rect1;              // é»˜è®¤æ„é€ å‡½æ•°
    Rectangle rect2(10, 20);       // å‚æ•°åŒ–æ„é€ å‡½æ•°
    Rectangle rect3(rect2);        // å¤åˆ¶æ„é€ å‡½æ•°
    Rectangle rect4(5);            // å§”æ‰˜æ„é€ å‡½æ•°
    Rectangle rect5(std::move(rect2)); // ç§»åŠ¨æ„é€ å‡½æ•°
    
    return 0;
}
```

### ææ„å‡½æ•°

```cpp
#include <iostream>

class Resource {
private:
    int* data;

public:
    Resource(int size) {
        data = new int[size];
        std::cout << "Resource allocated" << std::endl;
    }
    
    // ææ„å‡½æ•°ï¼šé‡Šæ”¾èµ„æº
    ~Resource() {
        delete[] data;
        std::cout << "Resource deallocated" << std::endl;
    }
    
    // ç¦ç”¨å¤åˆ¶ï¼ˆé¿å…æµ…å¤åˆ¶é—®é¢˜ï¼‰
    Resource(const Resource&) = delete;
    Resource& operator=(const Resource&) = delete;
};

int main() {
    {
        Resource res(100);
        // res ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°
    }
    std::cout << "Resource destroyed" << std::endl;
    
    return 0;
}
```

### this æŒ‡é’ˆ

```cpp
#include <iostream>

class Counter {
private:
    int count;

public:
    Counter(int c = 0) : count(c) {}
    
    // è¿”å› this æŒ‡é’ˆï¼ˆæ”¯æŒé“¾å¼è°ƒç”¨ï¼‰
    Counter& increment() {
        count++;
        return *this;  // è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨
    }
    
    Counter& decrement() {
        count--;
        return *this;
    }
    
    int getCount() const {
        return count;
    }
    
    // ä½¿ç”¨ this æŒ‡é’ˆè®¿é—®æˆå‘˜
    void setCount(int c) {
        this->count = c;  // æ˜¾å¼ä½¿ç”¨ this
    }
};

int main() {
    Counter c;
    c.increment().increment().increment();  // é“¾å¼è°ƒç”¨
    std::cout << "Count: " << c.getCount() << std::endl;  // 3
    
    return 0;
}
```

### é™æ€æˆå‘˜

```cpp
#include <iostream>

class Counter {
private:
    static int total_count;  // é™æ€æˆå‘˜å˜é‡ï¼ˆç±»çº§åˆ«ï¼‰
    int instance_count;      // å®ä¾‹æˆå‘˜å˜é‡

public:
    Counter() : instance_count(0) {
        total_count++;  // æ‰€æœ‰å®ä¾‹å…±äº«
    }
    
    // é™æ€æˆå‘˜å‡½æ•°
    static int getTotalCount() {
        return total_count;
        // ä¸èƒ½è®¿é—®éé™æ€æˆå‘˜
        // return instance_count;  // é”™è¯¯ï¼
    }
    
    void increment() {
        instance_count++;
        total_count++;
    }
    
    int getInstanceCount() const {
        return instance_count;
    }
};

// é™æ€æˆå‘˜å˜é‡å¿…é¡»åœ¨ç±»å¤–å®šä¹‰
int Counter::total_count = 0;

int main() {
    Counter c1, c2, c3;
    
    c1.increment();
    c2.increment();
    c2.increment();
    
    std::cout << "Total count: " << Counter::getTotalCount() << std::endl;  // 3
    std::cout << "c1 count: " << c1.getInstanceCount() << std::endl;       // 1
    std::cout << "c2 count: " << c2.getInstanceCount() << std::endl;       // 2
    
    return 0;
}
```

## ç»§æ‰¿

### åŸºæœ¬ç»§æ‰¿

```cpp
#include <iostream>
#include <string>

// åŸºç±»
class Animal {
protected:
    std::string name;

public:
    Animal(const std::string& n) : name(n) {}
    
    void eat() {
        std::cout << name << " is eating." << std::endl;
    }
    
    virtual void makeSound() {  // è™šå‡½æ•°
        std::cout << name << " makes a sound." << std::endl;
    }
    
    virtual ~Animal() = default;  // è™šææ„å‡½æ•°
};

// æ´¾ç”Ÿç±»
class Dog : public Animal {
public:
    Dog(const std::string& n) : Animal(n) {}
    
    // é‡å†™è™šå‡½æ•°
    void makeSound() override {
        std::cout << name << " barks: Woof!" << std::endl;
    }
    
    void fetch() {
        std::cout << name << " is fetching." << std::endl;
    }
};

class Cat : public Animal {
public:
    Cat(const std::string& n) : Animal(n) {}
    
    void makeSound() override {
        std::cout << name << " meows: Meow!" << std::endl;
    }
};

int main() {
    Dog dog("Buddy");
    Cat cat("Whiskers");
    
    dog.eat();        // ç»§æ‰¿è‡ªåŸºç±»
    dog.makeSound();  // è°ƒç”¨æ´¾ç”Ÿç±»ç‰ˆæœ¬
    dog.fetch();      // æ´¾ç”Ÿç±»ç‰¹æœ‰æ–¹æ³•
    
    cat.makeSound();
    
    return 0;
}
```

### ç»§æ‰¿æ–¹å¼

```cpp
#include <iostream>

class Base {
public:
    int public_member;
protected:
    int protected_member;
private:
    int private_member;
};

// å…¬æœ‰ç»§æ‰¿ï¼ˆæœ€å¸¸ç”¨ï¼‰
class PublicDerived : public Base {
    void test() {
        public_member = 1;      // OK
        protected_member = 2;   // OK
        // private_member = 3;  // é”™è¯¯ï¼ä¸èƒ½è®¿é—®ç§æœ‰æˆå‘˜
    }
};

// å—ä¿æŠ¤ç»§æ‰¿
class ProtectedDerived : protected Base {
    void test() {
        public_member = 1;      // OKï¼ˆå˜ä¸º protectedï¼‰
        protected_member = 2;   // OK
    }
};

// ç§æœ‰ç»§æ‰¿
class PrivateDerived : private Base {
    void test() {
        public_member = 1;      // OKï¼ˆå˜ä¸º privateï¼‰
        protected_member = 2;   // OKï¼ˆå˜ä¸º privateï¼‰
    }
};

int main() {
    PublicDerived pub;
    pub.public_member = 10;  // OK
    
    ProtectedDerived prot;
    // prot.public_member = 10;  // é”™è¯¯ï¼å˜ä¸º protected
    
    PrivateDerived priv;
    // priv.public_member = 10;  // é”™è¯¯ï¼å˜ä¸º private
    
    return 0;
}
```

### å¤šé‡ç»§æ‰¿

```cpp
#include <iostream>

class Flyable {
public:
    virtual void fly() {
        std::cout << "Flying..." << std::endl;
    }
};

class Swimmable {
public:
    virtual void swim() {
        std::cout << "Swimming..." << std::endl;
    }
};

// å¤šé‡ç»§æ‰¿
class Duck : public Flyable, public Swimmable {
public:
    void fly() override {
        std::cout << "Duck is flying." << std::endl;
    }
    
    void swim() override {
        std::cout << "Duck is swimming." << std::endl;
    }
};

int main() {
    Duck duck;
    duck.fly();
    duck.swim();
    
    return 0;
}
```

## å¤šæ€

### è™šå‡½æ•°

```cpp
#include <iostream>
#include <vector>
#include <memory>

class Shape {
protected:
    double x, y;

public:
    Shape(double x, double y) : x(x), y(y) {}
    
    // çº¯è™šå‡½æ•°ï¼ˆæŠ½è±¡ç±»ï¼‰
    virtual double area() const = 0;
    
    virtual void draw() const {
        std::cout << "Drawing shape at (" << x << ", " << y << ")" << std::endl;
    }
    
    virtual ~Shape() = default;
};

class Circle : public Shape {
private:
    double radius;

public:
    Circle(double x, double y, double r) : Shape(x, y), radius(r) {}
    
    double area() const override {
        return 3.14159 * radius * radius;
    }
    
    void draw() const override {
        std::cout << "Drawing circle at (" << x << ", " << y 
                  << ") with radius " << radius << std::endl;
    }
};

class Rectangle : public Shape {
private:
    double width, height;

public:
    Rectangle(double x, double y, double w, double h) 
        : Shape(x, y), width(w), height(h) {}
    
    double area() const override {
        return width * height;
    }
    
    void draw() const override {
        std::cout << "Drawing rectangle at (" << x << ", " << y 
                  << ") with size " << width << "x" << height << std::endl;
    }
};

int main() {
    // å¤šæ€ï¼šé€šè¿‡åŸºç±»æŒ‡é’ˆè°ƒç”¨æ´¾ç”Ÿç±»æ–¹æ³•
    std::vector<std::unique_ptr<Shape>> shapes;
    shapes.push_back(std::make_unique<Circle>(0, 0, 5));
    shapes.push_back(std::make_unique<Rectangle>(10, 10, 4, 6));
    
    for (const auto& shape : shapes) {
        shape->draw();  // è°ƒç”¨æ´¾ç”Ÿç±»çš„ draw()
        std::cout << "Area: " << shape->area() << std::endl;
    }
    
    return 0;
}
```

### è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰

```cpp
#include <iostream>

class Base {
public:
    virtual void func1() {
        std::cout << "Base::func1()" << std::endl;
    }
    
    virtual void func2() {
        std::cout << "Base::func2()" << std::endl;
    }
};

class Derived : public Base {
public:
    void func1() override {
        std::cout << "Derived::func1()" << std::endl;
    }
    
    // func2() ä½¿ç”¨åŸºç±»ç‰ˆæœ¬
};

int main() {
    Base* ptr = new Derived();
    ptr->func1();  // è°ƒç”¨ Derived::func1()ï¼ˆé€šè¿‡ vtableï¼‰
    ptr->func2();  // è°ƒç”¨ Base::func2()ï¼ˆé€šè¿‡ vtableï¼‰
    
    delete ptr;
    return 0;
}
```

### final å’Œ overrideï¼ˆC++11ï¼‰

```cpp
#include <iostream>

class Base {
public:
    virtual void func() {
        std::cout << "Base::func()" << std::endl;
    }
    
    virtual void final_func() final {  // ç¦æ­¢é‡å†™
        std::cout << "Base::final_func()" << std::endl;
    }
};

class Derived : public Base {
public:
    void func() override {  // æ˜ç¡®è¡¨ç¤ºé‡å†™
        std::cout << "Derived::func()" << std::endl;
    }
    
    // void final_func() override { }  // é”™è¯¯ï¼ä¸èƒ½é‡å†™ final å‡½æ•°
};

class FinalDerived final : public Derived {  // final ç±»ï¼Œç¦æ­¢ç»§æ‰¿
    // ...
};

// class MoreDerived : public FinalDerived { };  // é”™è¯¯ï¼ä¸èƒ½ç»§æ‰¿ final ç±»

int main() {
    Derived d;
    d.func();
    
    return 0;
}
```

## è¿ç®—ç¬¦é‡è½½

### åŸºæœ¬è¿ç®—ç¬¦é‡è½½

```cpp
#include <iostream>

class Vector {
private:
    double x, y;

public:
    Vector(double x = 0, double y = 0) : x(x), y(y) {}
    
    // è¿ç®—ç¬¦é‡è½½ï¼š+
    Vector operator+(const Vector& other) const {
        return Vector(x + other.x, y + other.y);
    }
    
    // è¿ç®—ç¬¦é‡è½½ï¼š-
    Vector operator-(const Vector& other) const {
        return Vector(x - other.x, y - other.y);
    }
    
    // è¿ç®—ç¬¦é‡è½½ï¼š*ï¼ˆæ ‡é‡ä¹˜æ³•ï¼‰
    Vector operator*(double scalar) const {
        return Vector(x * scalar, y * scalar);
    }
    
    // è¿ç®—ç¬¦é‡è½½ï¼š==
    bool operator==(const Vector& other) const {
        return x == other.x && y == other.y;
    }
    
    // è¿ç®—ç¬¦é‡è½½ï¼š<<ï¼ˆè¾“å‡ºï¼‰
    friend std::ostream& operator<<(std::ostream& os, const Vector& v) {
        os << "(" << v.x << ", " << v.y << ")";
        return os;
    }
    
    // è¿ç®—ç¬¦é‡è½½ï¼š[]ï¼ˆä¸‹æ ‡ï¼‰
    double& operator[](int index) {
        if (index == 0) return x;
        if (index == 1) return y;
        throw std::out_of_range("Index out of range");
    }
    
    // è¿ç®—ç¬¦é‡è½½ï¼š()ï¼ˆå‡½æ•°è°ƒç”¨ï¼‰
    double operator()(double scale) const {
        return (x + y) * scale;
    }
};

int main() {
    Vector v1(1, 2);
    Vector v2(3, 4);
    
    Vector v3 = v1 + v2;  // ä½¿ç”¨è¿ç®—ç¬¦é‡è½½
    std::cout << "v1 + v2 = " << v3 << std::endl;
    
    Vector v4 = v1 * 2;
    std::cout << "v1 * 2 = " << v4 << std::endl;
    
    std::cout << "v1[0] = " << v1[0] << std::endl;
    std::cout << "v1(10) = " << v1(10) << std::endl;
    
    return 0;
}
```

## å‹å…ƒ

### å‹å…ƒå‡½æ•°å’Œå‹å…ƒç±»

```cpp
#include <iostream>

class Rectangle {
private:
    double width, height;

public:
    Rectangle(double w, double h) : width(w), height(h) {}
    
    // å‹å…ƒå‡½æ•°ï¼šå¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜
    friend double calculateArea(const Rectangle& rect);
    
    // å‹å…ƒç±»ï¼šæ‰€æœ‰æˆå‘˜å‡½æ•°éƒ½å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜
    friend class RectangleHelper;
};

// å‹å…ƒå‡½æ•°å®šä¹‰
double calculateArea(const Rectangle& rect) {
    return rect.width * rect.height;  // å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜
}

// å‹å…ƒç±»
class RectangleHelper {
public:
    static void printInfo(const Rectangle& rect) {
        std::cout << "Width: " << rect.width 
                  << ", Height: " << rect.height << std::endl;
    }
};

int main() {
    Rectangle rect(10, 20);
    std::cout << "Area: " << calculateArea(rect) << std::endl;
    RectangleHelper::printInfo(rect);
    
    return 0;
}
```

## å®è·µç»ƒä¹ 

### ç»ƒä¹  1ï¼šé“¶è¡Œè´¦æˆ·ç³»ç»Ÿ

```cpp
#include <iostream>
#include <string>

class BankAccount {
private:
    std::string accountNumber;
    double balance;

public:
    BankAccount(const std::string& accNum, double initialBalance = 0)
        : accountNumber(accNum), balance(initialBalance) {}
    
    void deposit(double amount) {
        if (amount > 0) {
            balance += amount;
            std::cout << "Deposited: $" << amount << std::endl;
        }
    }
    
    bool withdraw(double amount) {
        if (amount > 0 && amount <= balance) {
            balance -= amount;
            std::cout << "Withdrawn: $" << amount << std::endl;
            return true;
        }
        std::cout << "Insufficient funds!" << std::endl;
        return false;
    }
    
    double getBalance() const {
        return balance;
    }
    
    std::string getAccountNumber() const {
        return accountNumber;
    }
};

int main() {
    BankAccount account("123456", 1000);
    account.deposit(500);
    account.withdraw(200);
    std::cout << "Balance: $" << account.getBalance() << std::endl;
    
    return 0;
}
```

## ä¸å…¶ä»–è¯­è¨€å¯¹æ¯”

| ç‰¹æ€§ | C++ | Java | Python | Go | Rust |
|------|-----|------|--------|-----|------|
| **ç±»å®šä¹‰** | `class Name {}` | `class Name {}` | `class Name:` | `type Name struct` | `struct Name` |
| **ç»§æ‰¿** | `class D : public B` | `class D extends B` | `class D(B):` | ç»„åˆ | Trait |
| **å¤šæ€** | è™šå‡½æ•° | æ–¹æ³•é‡å†™ | æ–¹æ³•é‡å†™ | æ¥å£ | Trait |
| **è®¿é—®æ§åˆ¶** | `public/private/protected` | `public/private/protected` | çº¦å®š | å¤§å°å†™ | `pub` |
| **è¿ç®—ç¬¦é‡è½½** | âœ… | âŒ | âœ… | âŒ | âœ… |

## ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»æŒæ¡äº†é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå¯ä»¥ç»§ç»­å­¦ä¹ ï¼š

1. **[å†…å­˜ç®¡ç†](./07-å†…å­˜ç®¡ç†.md)** - ç†è§£æŒ‡é’ˆã€å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆ
2. **[æ¨¡æ¿ç¼–ç¨‹](./08-æ¨¡æ¿ç¼–ç¨‹.md)** - å­¦ä¹ æ³›å‹ç¼–ç¨‹
3. **[STL æ ‡å‡†åº“](./09-STLæ ‡å‡†åº“.md)** - æŒæ¡æ ‡å‡†åº“çš„ä½¿ç”¨

ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ğŸ‰

