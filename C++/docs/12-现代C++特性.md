# ç°ä»£ C++ ç‰¹æ€§

ç°ä»£ C++ï¼ˆC++11 åŠä»¥åï¼‰å¼•å…¥äº†å¤§é‡æ–°ç‰¹æ€§ï¼Œä½¿ C++ æ›´å®‰å…¨ã€æ›´é«˜æ•ˆã€æ›´æ˜“ç”¨ã€‚æœ¬ç« èŠ‚ä»‹ç»ä¸»è¦çš„æ–°ç‰¹æ€§ã€‚

## C++11 ç‰¹æ€§

### auto å…³é”®å­—

```cpp
#include <iostream>
#include <vector>
#include <map>

int main() {
    // ç±»å‹æ¨æ–­
    auto x = 42;                    // int
    auto y = 3.14;                  // double
    auto z = "Hello";               // const char*
    auto vec = std::vector<int>();  // std::vector<int>
    
    // åœ¨å¾ªç¯ä¸­ä½¿ç”¨
    std::vector<int> numbers{1, 2, 3, 4, 5};
    for (auto it = numbers.begin(); it != numbers.end(); ++it) {
        std::cout << *it << " ";
    }
    std::cout << std::endl;
    
    // èŒƒå›´ for å¾ªç¯
    for (auto num : numbers) {
        std::cout << num << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

### èŒƒå›´ for å¾ªç¯

```cpp
#include <iostream>
#include <vector>
#include <map>
#include <string>

int main() {
    // æ•°ç»„
    int arr[] = {1, 2, 3, 4, 5};
    for (int elem : arr) {
        std::cout << elem << " ";
    }
    std::cout << std::endl;
    
    // å®¹å™¨
    std::vector<int> vec{1, 2, 3, 4, 5};
    for (int elem : vec) {
        std::cout << elem << " ";
    }
    std::cout << std::endl;
    
    // map
    std::map<std::string, int> scores{{"Alice", 95}, {"Bob", 87}};
    for (const auto& [name, score] : scores) {  // C++17 ç»“æ„åŒ–ç»‘å®š
        std::cout << name << ": " << score << std::endl;
    }
    
    return 0;
}
```

### Lambda è¡¨è¾¾å¼

```cpp
#include <iostream>
#include <vector>
#include <algorithm>

int main() {
    std::vector<int> vec{1, 2, 3, 4, 5};
    
    // åŸºæœ¬ lambda
    auto add = [](int a, int b) { return a + b; };
    std::cout << add(3, 4) << std::endl;
    
    // æ•è·å˜é‡
    int multiplier = 10;
    std::transform(vec.begin(), vec.end(), vec.begin(),
                   [multiplier](int x) { return x * multiplier; });
    
    // å¼•ç”¨æ•è·
    int sum = 0;
    std::for_each(vec.begin(), vec.end(),
                  [&sum](int x) { sum += x; });
    std::cout << "Sum: " << sum << std::endl;
    
    return 0;
}
```

### æ™ºèƒ½æŒ‡é’ˆ

```cpp
#include <iostream>
#include <memory>

int main() {
    // unique_ptrï¼šç‹¬å æ‰€æœ‰æƒ
    auto ptr1 = std::make_unique<int>(42);
    std::cout << *ptr1 << std::endl;
    
    // shared_ptrï¼šå…±äº«æ‰€æœ‰æƒ
    auto ptr2 = std::make_shared<int>(100);
    auto ptr3 = ptr2;  // å…±äº«
    std::cout << ptr2.use_count() << std::endl;  // 2
    
    // weak_ptrï¼šä¸å¢åŠ å¼•ç”¨è®¡æ•°
    std::weak_ptr<int> weak = ptr2;
    if (auto locked = weak.lock()) {
        std::cout << *locked << std::endl;
    }
    
    return 0;
}
```

### å³å€¼å¼•ç”¨å’Œç§»åŠ¨è¯­ä¹‰

```cpp
#include <iostream>
#include <string>
#include <vector>

class MyString {
private:
    char* data;
    size_t size;

public:
    // ç§»åŠ¨æ„é€ å‡½æ•°
    MyString(MyString&& other) noexcept 
        : data(other.data), size(other.size) {
        other.data = nullptr;
        other.size = 0;
    }
    
    // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦
    MyString& operator=(MyString&& other) noexcept {
        if (this != &other) {
            delete[] data;
            data = other.data;
            size = other.size;
            other.data = nullptr;
            other.size = 0;
        }
        return *this;
    }
};

int main() {
    MyString str1("Hello");
    MyString str2 = std::move(str1);  // ç§»åŠ¨æ„é€ 
    
    return 0;
}
```

## C++14 ç‰¹æ€§

### æ³›å‹ Lambda

```cpp
#include <iostream>

int main() {
    // ä½¿ç”¨ auto ä½œä¸ºå‚æ•°ç±»å‹
    auto add = [](auto a, auto b) {
        return a + b;
    };
    
    std::cout << add(3, 4) << std::endl;              // 7
    std::cout << add(3.5, 4.2) << std::endl;          // 7.7
    std::cout << add(std::string("Hello"), std::string("World")) << std::endl;
    
    return 0;
}
```

### å˜é‡æ¨¡æ¿

```cpp
#include <iostream>

template<typename T>
constexpr T pi = T(3.14159265358979323846);

int main() {
    std::cout << pi<int> << std::endl;        // 3
    std::cout << pi<double> << std::endl;     // 3.14159
    std::cout << pi<float> << std::endl;      // 3.14159
    
    return 0;
}
```

## C++17 ç‰¹æ€§

### ç»“æ„åŒ–ç»‘å®š

```cpp
#include <iostream>
#include <tuple>
#include <map>

int main() {
    // å…ƒç»„è§£æ„
    std::tuple<int, double, std::string> t{1, 3.14, "hello"};
    auto [a, b, c] = t;
    std::cout << a << ", " << b << ", " << c << std::endl;
    
    // map éå†
    std::map<std::string, int> scores{{"Alice", 95}, {"Bob", 87}};
    for (const auto& [name, score] : scores) {
        std::cout << name << ": " << score << std::endl;
    }
    
    return 0;
}
```

### if constexpr

```cpp
#include <iostream>
#include <type_traits>

template<typename T>
void process(T value) {
    if constexpr (std::is_integral_v<T>) {
        std::cout << "Integer: " << value * 2 << std::endl;
    } else if constexpr (std::is_floating_point_v<T>) {
        std::cout << "Float: " << value * 1.5 << std::endl;
    } else {
        std::cout << "Other: " << value << std::endl;
    }
}

int main() {
    process(10);      // Integer: 20
    process(3.14);    // Float: 4.71
    process("hello"); // Other: hello
    
    return 0;
}
```

### std::optional

```cpp
#include <iostream>
#include <optional>
#include <string>

std::optional<int> divide(int a, int b) {
    if (b != 0) {
        return a / b;
    }
    return std::nullopt;  // æ— å€¼
}

int main() {
    auto result = divide(10, 2);
    if (result.has_value()) {
        std::cout << "Result: " << result.value() << std::endl;
    }
    
    auto result2 = divide(10, 0);
    if (!result2.has_value()) {
        std::cout << "Division by zero!" << std::endl;
    }
    
    return 0;
}
```

### std::variant

```cpp
#include <iostream>
#include <variant>
#include <string>

int main() {
    std::variant<int, double, std::string> v;
    
    v = 42;
    std::cout << std::get<int>(v) << std::endl;
    
    v = 3.14;
    std::cout << std::get<double>(v) << std::endl;
    
    v = "Hello";
    std::cout << std::get<std::string>(v) << std::endl;
    
    // è®¿é—®
    std::visit([](auto&& arg) {
        std::cout << arg << std::endl;
    }, v);
    
    return 0;
}
```

## C++20 ç‰¹æ€§

### æ¦‚å¿µï¼ˆConceptsï¼‰

```cpp
#include <iostream>
#include <concepts>

// å®šä¹‰æ¦‚å¿µ
template<typename T>
concept Addable = requires(T a, T b) {
    { a + b } -> std::convertible_to<T>;
};

template<typename T>
concept Numeric = std::integral<T> || std::floating_point<T>;

// ä½¿ç”¨æ¦‚å¿µ
template<Addable T>
T add(T a, T b) {
    return a + b;
}

template<Numeric T>
T multiply(T a, T b) {
    return a * b;
}

int main() {
    std::cout << add(3, 4) << std::endl;        // 7
    std::cout << multiply(3.5, 4.2) << std::endl; // 14.7
    
    return 0;
}
```

### èŒƒå›´ï¼ˆRangesï¼‰

```cpp
#include <iostream>
#include <ranges>
#include <vector>
#include <algorithm>

int main() {
    std::vector<int> vec{1, 2, 3, 4, 5, 6, 7, 8, 9, 10};
    
    // ä½¿ç”¨èŒƒå›´è§†å›¾
    auto even = vec | std::views::filter([](int x) { return x % 2 == 0; })
                   | std::views::transform([](int x) { return x * 2; });
    
    for (int x : even) {
        std::cout << x << " ";  // 4 8 12 16 20
    }
    std::cout << std::endl;
    
    return 0;
}
```

### åç¨‹ï¼ˆCoroutinesï¼‰

```cpp
#include <iostream>
#include <coroutine>

// ç®€å•çš„ç”Ÿæˆå™¨åç¨‹
template<typename T>
struct Generator {
    struct promise_type {
        T current_value;
        
        std::suspend_always initial_suspend() { return {}; }
        std::suspend_always final_suspend() noexcept { return {}; }
        std::suspend_always yield_value(T value) {
            current_value = value;
            return {};
        }
        Generator get_return_object() {
            return Generator{std::coroutine_handle<promise_type>::from_promise(*this)};
        }
        void unhandled_exception() {}
    };
    
    std::coroutine_handle<promise_type> coro;
    
    Generator(std::coroutine_handle<promise_type> h) : coro(h) {}
    ~Generator() { if (coro) coro.destroy(); }
    
    bool next() {
        coro.resume();
        return !coro.done();
    }
    
    T value() {
        return coro.promise().current_value;
    }
};

Generator<int> fibonacci() {
    int a = 0, b = 1;
    while (true) {
        co_yield a;
        auto temp = a + b;
        a = b;
        b = temp;
    }
}

int main() {
    auto gen = fibonacci();
    for (int i = 0; i < 10; ++i) {
        gen.next();
        std::cout << gen.value() << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

## C++23 ç‰¹æ€§

### std::expected

```cpp
#include <iostream>
#include <expected>
#include <string>

std::expected<int, std::string> divide(int a, int b) {
    if (b == 0) {
        return std::unexpected("Division by zero");
    }
    return a / b;
}

int main() {
    auto result = divide(10, 2);
    if (result.has_value()) {
        std::cout << "Result: " << result.value() << std::endl;
    }
    
    auto result2 = divide(10, 0);
    if (!result2.has_value()) {
        std::cout << "Error: " << result2.error() << std::endl;
    }
    
    return 0;
}
```

## ç‰¹æ€§æ€»ç»“

| ç‰ˆæœ¬ | ä¸»è¦ç‰¹æ€§ |
|------|---------|
| **C++11** | autoã€lambdaã€æ™ºèƒ½æŒ‡é’ˆã€å³å€¼å¼•ç”¨ã€èŒƒå›´for |
| **C++14** | æ³›å‹lambdaã€å˜é‡æ¨¡æ¿ |
| **C++17** | ç»“æ„åŒ–ç»‘å®šã€if constexprã€optionalã€variant |
| **C++20** | æ¦‚å¿µã€èŒƒå›´ã€åç¨‹ |
| **C++23** | std::expectedã€æ¨¡å—æ”¹è¿› |

## ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»äº†è§£äº†ç°ä»£ C++ ç‰¹æ€§ï¼Œå¯ä»¥ç»§ç»­å­¦ä¹ ï¼š

1. **[æ–‡ä»¶æ“ä½œå’Œ I/O](./13-æ–‡ä»¶æ“ä½œå’ŒIO.md)** - æŒæ¡æ–‡ä»¶å¤„ç†
2. **[æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•](./14-æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•.md)** - å­¦ä¹ ä¼˜åŒ–æŠ€å·§

ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ğŸ‰

