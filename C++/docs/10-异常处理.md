# å¼‚å¸¸å¤„ç†

å¼‚å¸¸å¤„ç†æ˜¯ C++ ä¸­å¤„ç†é”™è¯¯çš„é‡è¦æœºåˆ¶ã€‚é€šè¿‡å¼‚å¸¸ï¼Œå¯ä»¥åœ¨é”™è¯¯å‘ç”Ÿæ—¶ä¼˜é›…åœ°å¤„ç†é—®é¢˜ï¼Œè€Œä¸æ˜¯è®©ç¨‹åºå´©æºƒã€‚

## åŸºæœ¬å¼‚å¸¸å¤„ç†

### try-catch å—

```cpp
#include <iostream>
#include <stdexcept>

int divide(int a, int b) {
    if (b == 0) {
        throw std::runtime_error("Division by zero!");
    }
    return a / b;
}

int main() {
    try {
        int result = divide(10, 0);
        std::cout << "Result: " << result << std::endl;
    } catch (const std::exception& e) {
        std::cout << "Error: " << e.what() << std::endl;
    }
    
    return 0;
}
```

### æ ‡å‡†å¼‚å¸¸ç±»å‹

```cpp
#include <iostream>
#include <stdexcept>
#include <string>

int main() {
    try {
        // æŠ›å‡ºæ ‡å‡†å¼‚å¸¸
        throw std::runtime_error("Runtime error occurred");
    } catch (const std::runtime_error& e) {
        std::cout << "Runtime error: " << e.what() << std::endl;
    }
    
    try {
        throw std::logic_error("Logic error occurred");
    } catch (const std::logic_error& e) {
        std::cout << "Logic error: " << e.what() << std::endl;
    }
    
    try {
        throw std::invalid_argument("Invalid argument");
    } catch (const std::invalid_argument& e) {
        std::cout << "Invalid argument: " << e.what() << std::endl;
    }
    
    try {
        throw std::out_of_range("Out of range");
    } catch (const std::out_of_range& e) {
        std::cout << "Out of range: " << e.what() << std::endl;
    }
    
    return 0;
}
```

### å¤šä¸ª catch å—

```cpp
#include <iostream>
#include <stdexcept>

void test_exception(int type) {
    if (type == 1) {
        throw std::runtime_error("Runtime error");
    } else if (type == 2) {
        throw std::logic_error("Logic error");
    } else if (type == 3) {
        throw 42;  // æŠ›å‡ºæ•´æ•°
    }
}

int main() {
    try {
        test_exception(1);
    } catch (const std::runtime_error& e) {
        std::cout << "Caught runtime_error: " << e.what() << std::endl;
    } catch (const std::logic_error& e) {
        std::cout << "Caught logic_error: " << e.what() << std::endl;
    } catch (int e) {
        std::cout << "Caught integer: " << e << std::endl;
    } catch (...) {
        std::cout << "Caught unknown exception" << std::endl;
    }
    
    return 0;
}
```

## è‡ªå®šä¹‰å¼‚å¸¸

### ç»§æ‰¿æ ‡å‡†å¼‚å¸¸

```cpp
#include <iostream>
#include <stdexcept>
#include <string>

// è‡ªå®šä¹‰å¼‚å¸¸ç±»
class MyException : public std::exception {
private:
    std::string message;

public:
    explicit MyException(const std::string& msg) : message(msg) {}
    
    const char* what() const noexcept override {
        return message.c_str();
    }
};

class DivisionByZeroException : public std::runtime_error {
public:
    explicit DivisionByZeroException(const std::string& msg)
        : std::runtime_error(msg) {}
};

int divide(int a, int b) {
    if (b == 0) {
        throw DivisionByZeroException("Cannot divide by zero");
    }
    return a / b;
}

int main() {
    try {
        divide(10, 0);
    } catch (const DivisionByZeroException& e) {
        std::cout << "Division error: " << e.what() << std::endl;
    } catch (const std::exception& e) {
        std::cout << "General error: " << e.what() << std::endl;
    }
    
    return 0;
}
```

## å¼‚å¸¸è§„èŒƒ

### noexceptï¼ˆC++11ï¼‰

```cpp
#include <iostream>

// å£°æ˜å‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸
void safe_function() noexcept {
    // è¿™ä¸ªå‡½æ•°ä¿è¯ä¸æŠ›å‡ºå¼‚å¸¸
    std::cout << "Safe function" << std::endl;
}

// æ¡ä»¶ noexcept
template<typename T>
void maybe_throw(T value) noexcept(std::is_nothrow_copy_constructible_v<T>) {
    T copy = value;
}

// noexcept è¿ç®—ç¬¦
void test_noexcept() {
    std::cout << std::boolalpha;
    std::cout << "safe_function is noexcept: " 
              << noexcept(safe_function()) << std::endl;
}

int main() {
    safe_function();
    test_noexcept();
    
    return 0;
}
```

## RAII å’Œå¼‚å¸¸å®‰å…¨

### å¼‚å¸¸å®‰å…¨ä¿è¯

```cpp
#include <iostream>
#include <memory>

// åŸºæœ¬ä¿è¯ï¼šèµ„æºä¸æ³„æ¼
void basic_guarantee() {
    auto ptr = std::make_unique<int>(42);
    // å³ä½¿æŠ›å‡ºå¼‚å¸¸ï¼Œptr ä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾
    throw std::runtime_error("Error");
}

// å¼ºä¿è¯ï¼šæ“ä½œè¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨å›æ»š
class Transaction {
private:
    int value;

public:
    Transaction(int v) : value(v) {}
    
    void commit() {
        // æäº¤äº‹åŠ¡
    }
    
    void rollback() {
        // å›æ»šäº‹åŠ¡
    }
};

// ä¸æŠ›å‡ºä¿è¯ï¼šå‡½æ•°ä¿è¯ä¸æŠ›å‡ºå¼‚å¸¸
void no_throw_guarantee() noexcept {
    // å®ç°å¿…é¡»ä¿è¯ä¸æŠ›å‡ºå¼‚å¸¸
}

int main() {
    try {
        basic_guarantee();
    } catch (...) {
        // èµ„æºå·²è‡ªåŠ¨é‡Šæ”¾
    }
    
    return 0;
}
```

## å®è·µç»ƒä¹ 

### ç»ƒä¹  1ï¼šæ–‡ä»¶è¯»å–å¼‚å¸¸å¤„ç†

```cpp
#include <iostream>
#include <fstream>
#include <stdexcept>
#include <string>

std::string read_file(const std::string& filename) {
    std::ifstream file(filename);
    if (!file.is_open()) {
        throw std::runtime_error("Cannot open file: " + filename);
    }
    
    std::string content;
    std::string line;
    while (std::getline(file, line)) {
        content += line + "\n";
    }
    
    if (file.bad()) {
        throw std::runtime_error("Error reading file: " + filename);
    }
    
    return content;
}

int main() {
    try {
        std::string content = read_file("nonexistent.txt");
        std::cout << content << std::endl;
    } catch (const std::exception& e) {
        std::cout << "Error: " << e.what() << std::endl;
    }
    
    return 0;
}
```

## ä¸å…¶ä»–è¯­è¨€å¯¹æ¯”

| ç‰¹æ€§ | C++ | Java | Python | Go | Rust |
|------|-----|------|--------|-----|------|
| **å¼‚å¸¸å¤„ç†** | try-catch | try-catch | try-except | panic-recover | Result/Option |
| **å¼‚å¸¸ç±»å‹** | ç»§æ‰¿ exception | ç»§æ‰¿ Exception | ç»§æ‰¿ Exception | æ—  | Result<T, E> |
| **finally** | RAII | finally | finally | defer | Drop trait |
| **å¼‚å¸¸è§„èŒƒ** | noexcept | throws | æ—  | æ—  | æ—  |

## ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»æŒæ¡äº†å¼‚å¸¸å¤„ç†ï¼Œå¯ä»¥ç»§ç»­å­¦ä¹ ï¼š

1. **[å¹¶å‘ç¼–ç¨‹](./11-å¹¶å‘ç¼–ç¨‹.md)** - å­¦ä¹ å¤šçº¿ç¨‹ç¼–ç¨‹
2. **[æ–‡ä»¶æ“ä½œå’Œ I/O](./13-æ–‡ä»¶æ“ä½œå’ŒIO.md)** - æŒæ¡æ–‡ä»¶å¤„ç†
3. **[æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•](./14-æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•.md)** - å­¦ä¹ ä¼˜åŒ–æŠ€å·§

ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ğŸ‰

