# 基础语法

## 包声明

每个 Go 文件必须以 `package` 声明开始。

```go
package main  // 可执行程序的入口包
package utils // 库包
```

**与其他语言对比**：
- **C++**: 没有 Go 这种包概念，主要通过头文件 `#include` 和命名空间 `namespace` 组织代码
- **Rust**: 使用 `mod` 模块系统
- **Java**: 使用 `package` 声明

## 导入包

### 单行导入

```go
import "fmt"
import "os"
```

### 多行导入

```go
import (
    "fmt"
    "os"
    "strings"
)
```

### 导入别名

```go
import (
    f "fmt"           // 使用 f 代替 fmt
    "database/sql"
    _ "github.com/go-sql-driver/mysql"  // 匿名导入（只执行 init）
)
```

**注意**：Go 要求导入的包必须被使用，否则编译错误。

## 变量声明

### 方式1: var 关键字

```go
var name string = "Go"
var age int = 10
var isActive bool = true
```

### 方式2: 类型推断

```go
var name = "Go"        // 自动推断为 string
var age = 10           // 自动推断为 int
var isActive = true    // 自动推断为 bool
```

### 方式3: 短变量声明（最常用）

```go
name := "Go"           // 只能在函数内使用
age := 10
isActive := true
```

### 方式4: 多变量声明

```go
var (
    name     string = "Go"
    age      int    = 10
    isActive bool   = true
)

// 或
var name, age, isActive = "Go", 10, true
name, age, isActive := "Go", 10, true
```

### 与其他语言对比

| 语言 | 变量声明 |
|------|---------|
| **Go** | `var x int = 10` 或 `x := 10` |
| **C++** | `int x = 10;` 或 `auto x = 10;` |
| **Rust** | `let x: i32 = 10;` 或 `let x = 10;` |
| **Java** | `int x = 10;` |

**Go 特点**：
- `:=` 只能在函数内使用
- 变量声明后必须使用
- 零值初始化（未赋值的变量有默认值）

## 常量

### 单常量

```go
const Pi = 3.14159
const MaxSize = 1024
```

### 多常量

```go
const (
    StatusOK    = 200
    StatusError = 500
)
```

### iota（常量生成器）

```go
const (
    Sunday = iota  // 0
    Monday         // 1
    Tuesday        // 2
    Wednesday      // 3
)

const (
    KB = 1 << (10 * iota)  // 1024
    MB                      // 1048576
    GB                      // 1073741824
)
```

**与其他语言对比**：
- **C++**: 既有 `#define` 宏，也有类型安全的 `const` / `constexpr`
- **Rust**: `const` 或 `static`
- **Java**: `static final`

## 零值

Go 中未初始化的变量有零值：

```go
var i int       // 0
var f float64   // 0.0
var b bool      // false
var s string    // ""
var p *int      // nil
var sl []int    // nil
var m map[string]int  // nil
```

**与其他语言对比**：
- **C++**: 局部变量如果未初始化，值不确定；类成员可有默认初始化
- **Rust**: 必须显式初始化
- **Java**: 基本类型有默认值，对象为 null

## 作用域

### 包级别变量

```go
package main

var globalVar = "全局变量"  // 包内可见

func main() {
    fmt.Println(globalVar)
}
```

### 函数级别变量

```go
func example() {
    localVar := "局部变量"  // 只在函数内可见
    fmt.Println(localVar)
}
```

### 块级别变量

```go
func example() {
    x := 10
    if x > 5 {
        y := 20  // 只在 if 块内可见
        fmt.Println(y)
    }
    // fmt.Println(y)  // 错误：y 未定义
}
```

## 实际应用场景 Demo

### Demo 1: 配置管理

```go
package main

import "fmt"

// 应用配置 - 使用 const 定义常量（编译时确定，不可修改）
const (
    AppName    = "MyApp"    // 应用名称
    AppVersion = "1.0.0"    // 应用版本
    MaxRetries = 3          // 最大重试次数
)

// 使用 var 定义变量（运行时可以修改）
var (
    DebugMode   = false     // 调试模式开关
    LogLevel    = "info"    // 日志级别
    ServerPort  = 8080      // 服务器端口号
)

func main() {
    // 输出应用配置信息
    fmt.Printf("应用: %s v%s\n", AppName, AppVersion)
    fmt.Printf("调试模式: %v\n", DebugMode)
    fmt.Printf("日志级别: %s\n", LogLevel)
    fmt.Printf("服务器端口: %d\n", ServerPort)
    fmt.Printf("最大重试次数: %d\n", MaxRetries)
}
```

### Demo 2: 状态码定义

```go
package main

import "fmt"

// HTTP 状态码 - 使用常量定义标准 HTTP 响应码
const (
    StatusOK                  = 200  // 成功
    StatusBadRequest          = 400  // 客户端错误
    StatusUnauthorized        = 401  // 未授权
    StatusNotFound            = 404  // 未找到
    StatusInternalServerError = 500  // 服务器内部错误
)

// 用户角色（使用 iota 自动递增）
// iota 在 const 块中从 0 开始，每行自动递增
const (
    RoleGuest = iota  // 0 - 访客
    RoleUser          // 1 - 普通用户
    RoleAdmin         // 2 - 管理员
    RoleSuperAdmin    // 3 - 超级管理员
)

// checkPermission 检查角色是否有管理员权限
func checkPermission(role int) bool {
    // 只有管理员及以上级别才有权限
    return role >= RoleAdmin
}

func main() {
    userRole := RoleUser      // 普通用户角色
    adminRole := RoleAdmin    // 管理员角色
    
    // 检查普通用户权限
    fmt.Printf("用户权限检查: %v\n", checkPermission(userRole))
    // 检查管理员权限
    fmt.Printf("管理员权限检查: %v\n", checkPermission(adminRole))
}
```

### Demo 3: 文件大小转换工具

```go
package main

import "fmt"

// 使用 iota 和位运算定义文件大小单位
// 1 << (10 * iota) 表示 2 的 (10 * iota) 次方
const (
    _  = iota             // 忽略第一个值（0），iota = 0
    KB = 1 << (10 * iota) // 1024 = 2^10，iota = 1
    MB                    // 1048576 = 2^20，iota = 2
    GB                    // 1073741824 = 2^30，iota = 3
    TB                    // 1099511627776 = 2^40，iota = 4
)

// formatSize 将字节数转换为人类可读的大小格式
func formatSize(bytes int64) string {
    // 使用无表达式的 switch，按条件匹配
    switch {
    case bytes >= TB:
        // 大于等于 TB，转换为 TB
        return fmt.Sprintf("%.2f TB", float64(bytes)/float64(TB))
    case bytes >= GB:
        // 大于等于 GB，转换为 GB
        return fmt.Sprintf("%.2f GB", float64(bytes)/float64(GB))
    case bytes >= MB:
        // 大于等于 MB，转换为 MB
        return fmt.Sprintf("%.2f MB", float64(bytes)/float64(MB))
    case bytes >= KB:
        // 大于等于 KB，转换为 KB
        return fmt.Sprintf("%.2f KB", float64(bytes)/float64(KB))
    default:
        // 小于 KB，直接显示字节数
        return fmt.Sprintf("%d B", bytes)
    }
}

func main() {
    // 测试不同大小的字节数
    sizes := []int64{512, 2048, 1048576, 2147483648, 1099511627776}
    
    // 遍历并格式化每个大小
    for _, size := range sizes {
        fmt.Printf("%d bytes = %s\n", size, formatSize(size))
    }
}
```

**输出**：
```
512 bytes = 512 B
2048 bytes = 2.00 KB
1048576 bytes = 1.00 MB
2147483648 bytes = 2.00 GB
1099511627776 bytes = 1.00 TB
```

### Demo 4: 命令行参数解析

```go
package main

import (
    "flag"
    "fmt"
)

func main() {
    // 定义命令行参数
    // flag.String/Int/Bool 返回的是指针类型
    var (
        name    = flag.String("name", "Guest", "用户名")  // -name 参数，默认值 "Guest"
        age     = flag.Int("age", 0, "年龄")              // -age 参数，默认值 0
        verbose = flag.Bool("v", false, "详细输出")        // -v 参数，默认值 false
    )
    
    // 解析命令行参数（必须在访问参数值之前调用）
    flag.Parse()
    
    // 使用 * 解引用指针获取实际值
    fmt.Printf("用户名: %s\n", *name)
    fmt.Printf("年龄: %d\n", *age)
    
    // 检查详细输出标志
    if *verbose {
        fmt.Println("详细模式已启用")
    }
}
```

**运行示例**：
```bash
go run main.go -name "张三" -age 25 -v
# 输出:
# 用户名: 张三
# 年龄: 25
# 详细模式已启用
```

## 语法规则总结

1. **分号**：通常不需要，Go 会自动插入
2. **大括号**：左大括号必须与语句同行
3. **命名**：
   - 大写字母开头：导出（public）
   - 小写字母开头：未导出（private）
4. **注释**：
   - 单行：`//`
   - 多行：`/* */`
   - 文档注释：`//` 或 `/* */`（用于 `go doc`）

## 下一步

- [数据类型](./03-数据类型.md) - 学习 Go 的各种数据类型

